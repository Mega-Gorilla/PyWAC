# v1.0.0 移行ガイド: モジュール名変更

## 概要

v1.0.0では、ネイティブモジュールの命名を改善し、公開APIとして正式にサポートします。

| 変更前 (v0.4.x) | 変更後 (v1.0.0) |
|-----------------|-----------------|
| `pywac._pywac_native` | `pywac.core` |
| `process_loopback_queue` | `pywac.capture` |
| `pywac._native` | 削除 |

## 影響を受けるコード

### 高レベルAPI（影響なし）

以下のAPIは**変更なし**で動作します：

```python
import pywac

# これらはすべて変更なしで動作
pywac.record_to_file("output.wav", duration=5)
pywac.record_process("spotify", "spotify.wav", duration=10)
pywac.set_app_volume("chrome", 0.5)
sessions = pywac.list_audio_sessions()
```

### 低レベルAPI（移行が必要）

ネイティブモジュールを直接使用している場合は、移行が必要です。

## 移行手順

### 1. `process_loopback_queue` からの移行

**変更前（v0.4.x）:**
```python
import process_loopback_queue
capture = process_loopback_queue.QueueBasedProcessCapture()
capture.start(pid)
```

**変更後（v1.0.0）:**
```python
from pywac.capture import QueueBasedProcessCapture
capture = QueueBasedProcessCapture()
capture.start(pid)
```

または：
```python
from pywac import capture
cap = capture.QueueBasedProcessCapture()
cap.start(pid)
```

### 2. `pywac._pywac_native` / `pywac._native` からの移行

**変更前（v0.4.x）:**
```python
from pywac._native import SessionEnumerator
# または
from pywac import _pywac_native
enumerator = _pywac_native.SessionEnumerator()
```

**変更後（v1.0.0）:**
```python
from pywac.core import SessionEnumerator
enumerator = SessionEnumerator()
```

または：
```python
from pywac import core
enumerator = core.SessionEnumerator()
```

### 3. 利用可能なクラス一覧

**pywac.core:**
- `SessionEnumerator` - オーディオセッションの列挙
- `SimpleLoopback` - システム全体のループバックキャプチャ
- `SessionState` - セッション状態の列挙型

**pywac.capture:**
- `QueueBasedProcessCapture` - プロセス固有のオーディオキャプチャ
- `ProcessInfo` - プロセス情報
- `list_audio_processes()` - オーディオプロセスの一覧取得

## 新機能

### refresh_sessions()

グローバルセッションマネージャーを更新する新しい関数：

```python
import pywac

# アプリケーションが開始/停止した後にセッションを更新
pywac.refresh_sessions()
sessions = pywac.list_audio_sessions()
```

### 非推奨警告

以下の関数は非推奨になり、警告が出力されます：

| 非推奨 | 代替 |
|--------|------|
| `find_app()` | `find_audio_session()` |
| `get_active_apps()` | `get_active_sessions()` |

```python
import pywac
import warnings

# 非推奨警告をキャッチ
with warnings.catch_warnings(record=True) as w:
    warnings.simplefilter("always")
    pywac.find_app("test")  # DeprecationWarning が発生
```

## 移行チェックリスト

- [ ] `import process_loopback_queue` を `from pywac.capture import ...` に変更
- [ ] `from pywac._native import ...` を `from pywac.core import ...` に変更
- [ ] `from pywac import _pywac_native` を `from pywac import core` に変更
- [ ] `find_app()` を `find_audio_session()` に変更
- [ ] `get_active_apps()` を `get_active_sessions()` に変更
- [ ] ビルド: `python setup.py build_ext --inplace`
- [ ] テスト実行: `pytest tests/`

## トラブルシューティング

### ImportError: cannot import name 'core' from 'pywac'

ネイティブ拡張がビルドされていません：

```powershell
# Visual Studio Developer環境で実行
python setup.py build_ext --inplace
```

### ModuleNotFoundError: No module named 'process_loopback_queue'

v1.0.0では `process_loopback_queue` は削除されました。以下に変更してください：

```python
# 変更前
import process_loopback_queue

# 変更後
from pywac import capture
```

## 質問・問題報告

問題が発生した場合は、GitHubでIssueを作成してください：
https://github.com/Mega-Gorilla/PyWAC/issues
